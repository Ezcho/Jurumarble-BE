<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CRUD간단하게 구현</title>
</head>
<body>
<br>
<h2>겜 CRUD</h2>
<form id="start-game-form">
  Stack: <input type="number" id="game-stack-start"><br>
  Team: <input type="text" id="team-count"><br>
  <button type="button" onclick="startGame()">게임시작</button>
</form>

<h3>팀 업뎃</h3>
<form id="team-update-form">
  Game ID: <input type="text" id="game-id-update"><br>
  Name: <textarea id="team-name"></textarea><br>
  Position: <textarea id="team-position"></textarea><br>
  <button type="button" onclick="updateTeam()">Update Team</button>
</form>

<button onclick="deleteGame()">해당 ip에 해당되는 팀 제거</button>
<script>
  async function startGame() {
    const stackValue = document.querySelector('#game-stack-start').value;
    try {
      let startResponse = await fetch("/api/v1/status/start", {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ stack: stackValue })
      });
      let startData = await startResponse.json();
      let gameId = startData.gameId;
      document.querySelector('#game-id-update').value = gameId;
      alert('Game started!');
      await fetch(`/api/gameMap/${gameId}`, {
        method: 'POST'
      });
    } catch (error) {
      console.error("게임 생성 실패:", error);
    }
  }
  async function updateTeam() {
    const gameId = document.querySelector('#game-id-update').value;
    const name = document.querySelector('#team-name').value;
    const position = document.querySelector('#team-position').value;
    try {
      let response = await fetch("/api/v1/status/" + gameId);
      let gameData = await response.json();
      gameData.teams.push({
        name: name,
        position: position
      });
      await fetch("/api/v1/status/" + gameId, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(gameData)
      });
      alert('Team updated!');
    } catch (error) {
      console.error("Error updating team:", error);
    }
  }
  async function deleteGame() {
    try {
      await fetch("/api/v1/status/end", {
        method: 'POST'
      });
      alert('Game deleted based on client IP!');
    } catch (error) {
      console.error("Error deleting game:", error);
    }
  }
  getAllMaps();
</script>
</body>
</html>
