<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>Read Map</h1>
<h2>칸 생성</h2>
ID: <input type="text" id="create-id"><br>
Name: <input type="text" id="create-name"><br>
Description: <input type = "text" id = "crete-description"><br>
<button onclick="createMap()">Create</button>
<h2>모든 칸</h2>
<ul id="maps-list">
</ul>
<button onclick="readMaps()">DB 다시 로드</button>
<h2>칸 업데이트</h2>
ID: <input type="text" id="update-id"><br>
New Name: <input type="text" id="update-name"><br>
New Description <input type="text" id="update-description"><br>
<button onclick="updateMap()">Update</button>
<h2>칸 삭제</h2>
ID: <input type="text" id="delete-id"><br>
<button onclick="deleteMap()">Delete</button>

<br/>
<h1>Game Management</h1>
<h2>Start Game</h2>
Team: <input type="number" id="team"><br>
Position: <input type="number" id="position"><br>
Stack: <input type="number" id="stack"><br>
<button onclick="startGame()">Start Game</button>

<h2>End Game</h2>
<button onclick="endGame()">End Game</button>



<script>
  async function createMap() {
    const id = document.getElementById('create-id').value;
    const name = document.getElementById('create-name').value;
    const response = await fetch('/api/v1/maps', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ id, name, description})
    });
    readMaps();  //업뎃
  }

  async function readMaps() {
    const response = await fetch('/api/v1/maps');
    const data = await response.json();
    const ul = document.getElementById('maps-list');
    ul.innerHTML = '';
    data.forEach(map => {
      const li = document.createElement('li');
      li.textContent = `ID: ${map.id}, Name: ${map.name}`;
      ul.appendChild(li);
    });
  }

  async function updateMap() {
    const id = document.getElementById('update-id').value;
    const name = document.getElementById('update-name').value;

    const response = await fetch(`/api/v1/maps/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ name, description })
    });
    readMaps();
  }

  async function deleteMap() {
    const id = document.getElementById('delete-id').value;
    const response = await fetch(`/api/v1/maps/${id}`, {
      method: 'DELETE'
    });
    readMaps();  // Update
  }
  async function startGame() {
    const team = document.getElementById('team').value;
    const position = document.getElementById('position').value;
    const stack = document.getElementById('stack').value;

    const response = await fetch('/api/v1/games/start', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ team, position, stack })
    });
    const result = await response.json();
    alert('Game started! ID: ' + result.gameId);
  }

  async function endGame() {
    const response = await fetch('/api/v1/games/end', {
      method: 'POST'
    });
    if (response.status === 200) {
      alert('Game ended!');
    } else {
      alert('Failed to end game!');
    }
  }


  readMaps();

</script>
</body>
</html>
